version: '3.8'
services:
  payload:
    image: "${TESTING_IMAGE}"

  mongo:
    image: mongo:latest
    environment:
      ME_CONFIG_MONGODB_ADMINUSERNAME: "${TESTING_IMAGE}"
      ME_CONFIG_MONGODB_ADMINPASSWORD: "${TESTING_IMAGE}"
      ME_CONFIG_MONGODB_URL: 'mongodb+srv://${MONGODB_ADMINUSERNAME}:${MONGODB_ADMINPASSWORD}@sitatlas-cluster.3eew6oe.mongodb.net/payload_sandbox'
    volumes:
      -./infra:/healthchecks
    healthcheck:
      test: echo 'db.runCommand("ping").ok' | mongo mongo:27017/test --quiet
      interval: 10s
  sut:
    image: "${TESTING_IMAGE}"
    depends_on:
      payload:
        condition: service_started
      mongo:
        condition: service_healthy
    command: exit 1
